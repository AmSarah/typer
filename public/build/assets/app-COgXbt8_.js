$(document).ready(function(){class h{constructor(){this.quotes=[],this.originalQuote="",this.author="Source Title",this.level="medium",this.startTime=null,this.endTime=null,this.timerInterval=null,this.myChart=null,this.mistakes=0,this.init()}init(){this.bindEvents(),this.fetchQuotes(),this.createChart(),this.generateQuote()}fetchQuotes(){axios.get("https://api.quotable.io/quotes").then(e=>{if(!e.data||!Array.isArray(e.data.results))throw new Error("Invalid response format");this.quotes=e.data.results,this.generateQuote(),$("#quote").show()}).catch(e=>{console.error("Error fetching quotes:",e),$("#quote").text("Error fetching quotes. Please try again later.")})}generateQuote(){if(!this.quotes||this.quotes.length===0){console.error("No quotes available.");return}this.level=$('input[name="levels"]:checked').attr("id");const t=this.quotes.filter(r=>{switch(this.level){case"short":return r.length<80;case"medium":return r.length>=80&&r.length<100;case"long":return r.length>=100;default:return!1}});if(t.length===0){console.error("No quotes available for the selected level.");return}const e=Math.floor(Math.random()*t.length),s=t[e];$("#quote").text(s.content),$("#author").text(s.author),$("#userAnswer").val("").prop("disabled",!1),this.originalQuote=s.content,this.mistakes=0}bindEvents(){$("#userAnswer").off("input").on("input",()=>this.checkAnswer()),$(".btn-play-again").off("click").click(()=>this.resetGame()),$('input[type="radio"]').off("change").change(()=>this.resetGame()),$("#refresh").off("click").click(()=>this.resetGame())}checkAnswer(){const t=$("#userAnswer").val().trim(),e=this.originalQuote;let s=!0;!this.startTime&&t.length>0&&(this.startTime=new Date,this.startTimer());for(let r=0;r<t.length;r++)if(t[r]!==e[r]){s=!1;break}$("#userAnswer").css("color",s?"green":"red"),s&&t.length===e.length&&(this.endTime=new Date,this.showResult(),clearInterval(this.timerInterval),$("#userAnswer").prop("disabled",!0))}resetGame(){$("#userAnswer").val("").prop("disabled",!1),$("#counter").text("0:00"),$("#userAnswer").css("color","black"),this.startTime=null,this.endTime=null,clearInterval(this.timerInterval),this.mistakes=0,this.generateQuote(),this.closeResultModal()}createChart(){const t=document.getElementById("wpmChart").getContext("2d");this.myChart=new Chart(t,{type:"line",data:{labels:["1","2","3","4","5"],datasets:[{label:"WPM Over Time",data:[],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.1}]},options:{scales:{y:{beginAtZero:!0}}}})}updateChartData(t){this.myChart.data.datasets[0].data=t,this.myChart.update()}showResult(){$("#userAnswer").val().trim();const t=this.originalQuote,e=t.length,s=t.split(" ").length,r=(this.endTime-this.startTime)/1e3,a=Math.round(s/r*60),i=Math.round((e-this.mistakes)/e*100),n=Math.round(this.mistakes/s*100);$("#wpm").text(`WPM: ${a}`),$("#accuracy").text(`Accuracy: ${i}%`),$("#errorRate").text(`Error Rate: ${n}%`);const l=$("#counter").text();if($("#completionTime").text(`Completion Time: ${l}`),$("#exampleModal").modal("show"),this.myChart)this.myChart.data.labels.push(this.myChart.data.labels.length+1),this.myChart.data.datasets[0].data.push(a),this.myChart.update();else{const o=document.getElementById("wpmChart").getContext("2d");this.myChart=new Chart(o,{type:"line",data:{labels:["1"],datasets:[{label:"WPM Over Time",data:[a],borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.1}]},options:{scales:{y:{beginAtZero:!0}}}})}$.ajax({url:"/rounds",type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},data:{quote:$("#quote").text(),author:$("#author").text(),level:$('input[name="levels"]:checked').attr("id"),wpm:a,accuracy:i,error_rate:n,completion_time:l},success:function(o){console.log("Game result saved successfully")},error:function(o,d,c){console.error("Error saving game result:",c)}})}closeResultModal(){$("#exampleModal").modal("hide")}startTimer(){let t=0;this.timerInterval=setInterval(()=>{const e=Math.floor(t/60),s=t%60;$("#counter").text(`${e}:${s<10?"0":""}${s}`),t++},1e3)}}new h});
